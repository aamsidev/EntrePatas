@{
    ViewData["Title"] = "Panel de Cliente";
    Layout = "~/Views/Shared/_Layout.cshtml";
    @model IEnumerable<EntrePatasWEB.Models.AnimalDTO>
    var productos = ViewBag.Productos as List<EntrePatasWEB.Models.ProductoDTO>;
}



<hr class="my-5" />

<div class="container">
    <h2 class="fw-bold text-secondary mb-4">🐾 Mascotas en Adopción</h2>

    <div id="adopcionCarouselDark" class="carousel carousel-dark slide mb-5" data-bs-ride="carousel">


        <div class="carousel-indicators">
            @if (Model != null && Model.Any())
            {
                for (int i = 0; i < Model.Count(); i++)
                {
                    <button type="button" data-bs-target="#adopcionCarouselDark" data-bs-slide-to="@i" class="@(i == 0 ? "active" : "")" aria-current="@(i == 0 ? "true" : "false")" aria-label="Slide @(i + 1)"></button>
                }
            }
        </div>


        <div class="carousel-inner">
            @if (Model != null && Model.Any())
            {
                var first = true;
                foreach (var animal in Model)
                {
                    <div class="carousel-item @(first ? "active" : "")">
                        <div class="d-flex justify-content-center mb-3">
                            <img src="@Url.Content($"~/imagenes/animal/{(string.IsNullOrEmpty(animal.Foto) ? "default-animal.jpg" : animal.Foto)}")"
                                 class="d-block w-50 rounded shadow"
                                 style="max-height: 400px; object-fit: cover;"
                                 alt="@animal.Nombre" />
                        </div>
                        <div class="carousel-caption d-none d-md-block bg-dark bg-opacity-50 rounded p-3">
                            <h5 class="fw-bold text-white">@animal.Nombre</h5>
                            <p class="text-white">@animal.Descripcion | "Mascota en adopción."</p>
                            <a href="@Url.Action("Create", "Solicitud", new { idAnimal = animal.IdAnimal })" class="btn btn-primary">Adoptar</a>
                        </div>
                    </div>
                    first = false;
                }
            }
            else
            {
                <div class="carousel-item active">
                    <div class="d-flex justify-content-center mb-3">
                        <img src="https://placedog.net/600/400?id=1"
                             class="d-block w-50 rounded shadow"
                             style="max-height: 400px; object-fit: cover;"
                             alt="Sin mascotas" />
                    </div>
                    <div class="carousel-caption d-none d-md-block bg-dark bg-opacity-50 rounded p-3">
                        <h5 class="fw-bold">No hay mascotas para mostrar</h5>
                        <p>Vuelve más tarde.</p>
                    </div>
                </div>
            }
        </div>


        <button class="carousel-control-prev" type="button" data-bs-target="#adopcionCarouselDark" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#adopcionCarouselDark" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
        </button>

    </div>


    <hr class="my-5" />

</div>


<div id="contenedorAnimales" class="container mt-5">
    @Html.Partial("~/Views/Animal/_AnimalFiltro.cshtml", Model)
</div>

@section Scripts {
    <script>
        $(document).on('submit', '#formFiltro', function (e) {
            e.preventDefault();
            $.ajax({
                url: '@Url.Action("~/Views/Animal/_AnimalFiltro.cshtml", "Cliente")',
                type: 'GET',
                data: $(this).serialize(),
                success: function (resultado) {
                    $('#contenedorAnimales').html(resultado);
                },
                error: function () {
                    alert("Error al aplicar el filtro.");
                }
            });
        });

        document.addEventListener('DOMContentLoaded', function () {
            new bootstrap.Carousel(document.querySelector('#adopcionCarousel'), {
                interval: 3000,
                ride: 'carousel'
            });
        });
    </script>
}
