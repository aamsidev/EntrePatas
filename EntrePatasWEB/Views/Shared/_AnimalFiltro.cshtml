@model IEnumerable<EntrePatasWEB.Models.AnimalDTO>

@{
    ViewData["Title"] = "Adopciones";

    string estadoSel = ViewBag.EstadoSeleccionado as string;
    int? edadSel = ViewBag.EdadSeleccionada as int?;
    string razaSel = ViewBag.RazaSeleccionada as string;

    var estados = ViewBag.Estados as IEnumerable<string> ?? Enumerable.Empty<string>();
    var edades = ViewBag.Edades as IEnumerable<int> ?? Enumerable.Empty<int>();
    var razas = ViewBag.Razas as IEnumerable<string> ?? Enumerable.Empty<string>();
}

<style>
    .card-animal {
        min-height: 440px; 
        display: flex;
        flex-direction: column;
        border-radius: 1rem;
        overflow: hidden;
        transition: transform 0.3s, box-shadow 0.3s;
    }

    .card-animal:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 25px rgba(0,0,0,0.15);
    }

    .img-animal {
        height: 220px;
        width: 100%;
        object-fit: cover;
        transition: transform 0.3s;
    }

    .card-animal:hover .img-animal {
        transform: scale(1.05);
    }

    .card-body {
        flex-grow: 1; 
    }

    /* Etiqueta Disponible */
    .label-disponible {
        position: absolute;
        top: 10px;
        left: 10px;
        background-color: #28a745;
        color: white;
        padding: 0.3rem 0.6rem;
        border-radius: 0.5rem;
        font-weight: bold;
        font-size: 0.9rem;
        animation: pulse 1.5s infinite;
        box-shadow: 0 0 8px rgba(40,167,69,0.7);
    }

    @@keyframes pulse {
        0% { transform: scale(1); opacity: 1; }
        50% { transform: scale(1.1); opacity: 0.8; }
        100% { transform: scale(1); opacity: 1; }
    }

    .card-footer a {
        transition: transform 0.2s;
    }

    .card-footer a:hover {
        transform: scale(1.05);
    }
</style>

<h2 class="mb-4">Animales en Adopción</h2>

<form id="formFiltro" method="get" asp-action="_AnimalFiltro" class="row g-3 mb-4">
    <div class="col-md-4">
        <label for="estado" class="form-label">Estado</label>
        <select id="estado" name="estado" class="form-select">
            <option value="">-- Todos --</option>
            @foreach (var e in estados)
            {
                <option value="@e" @@(estadoSel == e ? "selected" : "")>@e</option>
            }
        </select>
    </div>

    <div class="col-md-4">
        <label for="edad" class="form-label">Edad</label>
        <select id="edad" name="edad" class="form-select">
            <option value="">-- Todas --</option>
            @foreach (var e in edades)
            {
                <option value="@e" @@(edadSel.HasValue && edadSel.Value == e ? "selected" : "")>@e año(s)</option>
            }
        </select>
    </div>

    <div class="col-md-4">
        <label for="raza" class="form-label">Raza</label>
        <select id="raza" name="raza" class="form-select">
            <option value="">-- Todas --</option>
            @foreach (var r in razas)
            {
                <option value="@r" @@(razaSel == r ? "selected" : "")>@r</option>
            }
        </select>
    </div>

    <div class="col-12 d-flex justify-content-end">
        <button type="submit" class="btn btn-primary">Filtrar</button>
    </div>
</form>

<div class="row row-cols-1 row-cols-md-3 g-4">
    @foreach (var item in Model)
    {
        <div class="col position-relative">
            <div class="card card-animal shadow-sm">
                @if (item.Estado?.ToLower() == "disponible")
                {
                    <div class="label-disponible">Disponible</div>
                }
                <img src="@Url.Content($"~/imagenes/animal/{(string.IsNullOrEmpty(item.Foto) ? "default-animal.jpg" : item.Foto)}")"
                     class="card-img-top img-animal"
                     alt="Imagen de @item.Nombre" />
                <div class="card-body">
                    <h5 class="card-title">@item.Nombre</h5>
                    <p><strong>Especie:</strong> @item.Especie</p>
                    <p><strong>Raza:</strong> @item.Raza</p>
                    <p><strong>Edad:</strong> @item.Edad año(s)</p>
                    <p><strong>Estado:</strong> @item.Estado</p>
                </div>
                <div class="card-footer text-center">
                    <a asp-controller="Animal" asp-action="Details" asp-route-id="@item.IdAnimal" class="btn btn-outline-primary btn-sm">
                        Ver detalles
                    </a>
                </div>
            </div>
        </div>
    }
</div>
