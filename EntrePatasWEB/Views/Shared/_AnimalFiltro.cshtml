@model IEnumerable<EntrePatasWEB.Models.AnimalDTO>

@{
    ViewData["Title"] = "Adopciones";

    string estadoSel = ViewBag.EstadoSeleccionado as string;
    int? edadSel = ViewBag.EdadSeleccionada as int?;
    string razaSel = ViewBag.RazaSeleccionada as string;

    var estados = ViewBag.Estados as IEnumerable<string> ?? Enumerable.Empty<string>();
    var edades = ViewBag.Edades as IEnumerable<int> ?? Enumerable.Empty<int>();
    var razas = ViewBag.Razas as IEnumerable<string> ?? Enumerable.Empty<string>();
}

<style>
    /* ====== CARD ANIMAL CON EFECTO NEÓN ====== */
    .card-animal {
        position: relative;
        width: 100%;
        min-height: 440px;
        color: #fff;
        cursor: pointer;
        border-radius: 1.2em;
        transition: 0.5s;
        overflow: hidden;
    }

    .card-animal:hover {
        transform: translateY(-15px);
    }

    .card-animal::before {
        content: '';
        width: 100%;
        height: 100%;
        position: absolute;
        top: 0;
        left: 0;
        background: linear-gradient(45deg, #ffbc00, #ff0058);
        border-radius: 1.2em;
    }

    .card-animal::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(45deg, #ffbc00, #ff0058);
        filter: blur(30px);
    }

    .card-animal span {
        position: absolute;
        top: 6px;
        left: 6px;
        right: 6px;
        bottom: 6px;
        background-color: rgba(0, 0, 0, 0.75);
        z-index: 2;
        border-radius: 1em;
        display: flex;
        flex-direction: column;
    }

    .card-animal span::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 50%;
        height: 100%;
        background-color: rgba(255, 255, 255, 0.1);
    }

    /* Imagen */
    .card-animal .img-animal {
        height: 220px;
        width: 100%;
        object-fit: cover;
        border-radius: 0.8em 0.8em 0 0;
        transition: transform 0.3s;
        z-index: 5;
    }

    .card-animal:hover .img-animal {
        transform: scale(1.05);
    }

    /* Contenido */
    .card-animal .content {
        padding: 15px;
        z-index: 5;
        flex-grow: 1;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        color: #fff;
    }

    .card-animal h5, 
    .card-animal p {
        margin: 0 0 5px 0;
    }

    /* Botón */
    .card-animal .card-footer {
        text-align: center;
        z-index: 10;
        margin-bottom: 10px;
    }

    .card-animal .card-footer a {
        transition: transform 0.2s;
    }

    .card-animal .card-footer a:hover {
        transform: scale(1.05);
    }

    /* Etiqueta disponible */
    .label-disponible {
        position: absolute;
        top: 15px;
        left: 15px;
        background-color: #28a745;
        color: white;
        padding: 0.3rem 0.6rem;
        border-radius: 0.5rem;
        font-weight: bold;
        font-size: 0.9rem;
        animation: pulse 1.5s infinite;
        z-index: 20;
    }

    @@keyframes pulse {
        0% { transform: scale(1); opacity: 1; }
        50% { transform: scale(1.1); opacity: 0.8; }
        100% { transform: scale(1); opacity: 1; }
    }
</style>

<h2 class="mb-4">Animales en Adopción</h2>

<form id="formFiltro" method="get" asp-action="_AnimalFiltro" class="row g-3 mb-4">
    <div class="col-md-4">
        <label for="estado" class="form-label">Estado</label>
        <select id="estado" name="estado" class="form-select">
            <option value="">-- Todos --</option>
            @foreach (var e in estados)
            {
                <option value="@e" @@(estadoSel == e ? "selected" : "")>@e</option>
            }
        </select>
    </div>

    <div class="col-md-4">
        <label for="edad" class="form-label">Edad</label>
        <select id="edad" name="edad" class="form-select">
            <option value="">-- Todas --</option>
            @foreach (var e in edades)
            {
                <option value="@e" @@(edadSel.HasValue && edadSel.Value == e ? "selected" : "")>@e año(s)</option>
            }
        </select>
    </div>

    <div class="col-md-4">
        <label for="raza" class="form-label">Raza</label>
        <select id="raza" name="raza" class="form-select">
            <option value="">-- Todas --</option>
            @foreach (var r in razas)
            {
                <option value="@r" @@(razaSel == r ? "selected" : "")>@r</option>
            }
        </select>
    </div>

    <div class="col-12 d-flex justify-content-end">
        <button type="submit" class="btn btn-primary">Filtrar</button>
    </div>
</form>

<div class="row row-cols-1 row-cols-md-3 g-4">
    @foreach (var item in Model)
    {
        <div class="col">
            <div class="card-animal shadow-sm">
                <span>
                    @if (item.Estado?.ToLower() == "disponible")
                    {
                        <div class="label-disponible">Disponible</div>
                    }
                    <img src="@Url.Content($"~/imagenes/animal/{(string.IsNullOrEmpty(item.Foto) ? "default-animal.jpg" : item.Foto)}")"
                         class="img-animal"
                         alt="Imagen de @item.Nombre" />
                    <div class="content">
                        <h5>@item.Nombre</h5>
                        <p><strong>Especie:</strong> @item.Especie</p>
                        <p><strong>Raza:</strong> @item.Raza</p>
                        <p><strong>Edad:</strong> @item.Edad año(s)</p>
                        <p><strong>Estado:</strong> @item.Estado</p>
                    </div>
                    <div class="card-footer">
                        <a asp-controller="Animal" asp-action="Details" asp-route-id="@item.IdAnimal" class="btn btn-outline-light btn-sm">
                            Ver detalles
                        </a>
                    </div>
                </span>
            </div>
        </div>
    }
</div>
