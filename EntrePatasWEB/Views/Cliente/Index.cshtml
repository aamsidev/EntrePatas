@{
    ViewData["Title"] = "Panel de Cliente";
    Layout = "~/Views/Shared/_Layout.cshtml"; // Asegúrate de tenerlo
  
    @model IEnumerable<EntrePatasWEB.Models.AnimalDTO>
    var productos = ViewBag.Productos as List<EntrePatasWEB.Models.ProductoDTO>;
}




<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />


<style>
    .carousel-inner img {
        height: 400px;
        width: 100%;
        object-fit: cover;
        object-position: center;
    }
</style>

<div class="container mt-5">
    <div class="text-center">
        <h1 class="display-4">¡Bienvenido al Panel del Cliente!</h1>
        @if (!string.IsNullOrEmpty(ViewBag.NombreUsuario))
        {
            <p class="lead">Hola, <strong>@ViewBag.NombreUsuario</strong> 👋</p>
        }
        else
        {
            <p class="lead">Explora mascotas para adoptar o productos para tus animales.</p>
        }
    </div>

    <hr />
    
    <!-- 🐾 Carrusel de Adopción -->
    <div id="adopcionCarousel" class="carousel slide" data-bs-ride="carousel">
        <div class="carousel-inner">
            @if (Model != null && Model.Any())
            {
                var first = true;
                foreach (var animal in Model)
                {
                    <div class="carousel-item @(first ? "active" : "")">
                        <div class="d-flex justify-content-center">
                            <img src="@Url.Content($"~/imagenes/animal/{(string.IsNullOrEmpty(animal.Foto) ? "default-animal.jpg" : animal.Foto)}")"
                                 class="d-block w-50" alt="@animal.Nombre" />
                        </div>
                        <div class="carousel-caption d-none d-md-block">
                            <h5>@animal.Nombre</h5>
                            <p>@animal.Descripcion ?? "Mascota en adopción."</p>
                            <a href="#" class="btn btn-success">Adoptar</a>
                        </div>
                    </div>
                    first = false;
                }
            }
            else
            {
                <div class="carousel-item active">
                    <div class="d-flex justify-content-center">
                        <img src="https://placedog.net/600/400?id=1" class="d-block w-50" alt="Sin mascotas" />
                    </div>
                    <div class="carousel-caption d-none d-md-block">
                        <h5>No hay mascotas para mostrar</h5>
                        <p>Vuelve más tarde.</p>
                    </div>
                </div>
            }
        </div>

        <button class="carousel-control-prev" type="button" data-bs-target="#adopcionCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon"></span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#adopcionCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon"></span>
        </button>
    </div>

    <hr class="my-5" />

    <!-- 🛒 Carrusel de Productos -->
    <h2 id="productos" class="mb-3">🛒 Productos Veterinarios</h2>
    <div id="productosCarousel" class="carousel slide" data-bs-ride="carousel">
        <div class="carousel-inner">
            @if (productos != null && productos.Any())
            {
                var first = true;
                foreach (var producto in productos)
                {
                    <div class="carousel-item @(first ? "active" : "")">
                        <div class="d-flex justify-content-center">
                            <img src="@Url.Content($"~/imagenes/producto/{(string.IsNullOrEmpty(producto.FotoUrl) ? "default-producto.jpg" : producto.FotoUrl)}")"
                                 class="d-block w-50" alt="@producto.Nombre" />
                        </div>
                        <div class="carousel-caption d-none d-md-block">
                            <h5>@producto.Nombre</h5>
                            <p>@producto.Descripcion</p>
                            <a href="#" class="btn btn-primary">Comprar</a>
                        </div>
                    </div>
                    first = false;
                }
            }
            else
            {
                <div class="carousel-item active">
                    <div class="d-flex justify-content-center">
                        <img src="https://via.placeholder.com/600x400?text=Sin+productos" class="d-block w-50" alt="Sin productos" />
                    </div>
                    <div class="carousel-caption d-none d-md-block">
                        <h5>No hay productos disponibles</h5>
                        <p>Vuelve más tarde para ver nuevas ofertas.</p>
                    </div>
                </div>
            }
        </div>

        <button class="carousel-control-prev" type="button" data-bs-target="#productosCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon"></span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#productosCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon"></span>
        </button>
    </div>
</div>

<!-- Aquí insertamos la vista parcial -->
<div id="contenedorAnimales">
    @Html.Partial("_AnimalFiltro", Model)
</div>







@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function () {
            // Evento al enviar el formulario
            $(document).on('submit', '#formFiltro', function (e) {
                e.preventDefault(); // Evita que recargue la página

                $.ajax({
                    url: '@Url.Action("_AnimalFiltro", "Cliente")',
                    type: 'GET',
                    data: $(this).serialize(), // Serializa los filtros
                    success: function (resultado) {
                        $('#contenedorAnimales').html(resultado); // Actualiza el parcial
                    },
                    error: function () {
                        alert("Error al aplicar el filtro.");
                    }
                });
            });
        });
    </script>
}

<script>
    document.addEventListener('DOMContentLoaded', function () {
        var myCarousel = document.querySelector('#adopcionCarousel');
        var carousel = new bootstrap.Carousel(myCarousel, {
            interval: 3000, // Cambiar cada 3 segundos
            ride: 'carousel'
        });
    });
</script>