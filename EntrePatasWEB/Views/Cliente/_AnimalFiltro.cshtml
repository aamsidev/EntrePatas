@model IEnumerable<EntrePatasWEB.Models.AnimalDTO>

@{
    ViewData["Title"] = "Adopciones";

    string estadoSel = ViewBag.EstadoSeleccionado as string;
    int? edadSel = ViewBag.EdadSeleccionada as int?;
    string razaSel = ViewBag.RazaSeleccionada as string;

    var estados = ViewBag.Estados as IEnumerable<string> ?? Enumerable.Empty<string>();
    var edades = ViewBag.Edades as IEnumerable<int> ?? Enumerable.Empty<int>();
    var razas = ViewBag.Razas as IEnumerable<string> ?? Enumerable.Empty<string>();
}

<style>
    .img-animal {
        height: 220px;
        width: 100%;
        object-fit: cover;
        border-radius: 0.5rem 0.5rem 0 0;
        background-color: #f8f9fa;
    }

    .card-animal {
        min-height: 420px; 
        display: flex;
        flex-direction: column;
    }

        .card-animal .card-body {
            flex-grow: 1; 
        }
</style>

<h2 class="mb-4">Animales en Adopción</h2>


<form id="formFiltro" method="get" asp-action="_AnimalFiltro" class="row g-3 mb-4">
    <div class="col-md-4">
        <label for="estado" class="form-label">Estado</label>
        <select id="estado" name="estado" class="form-select">
            <option value="">-- Todos --</option>
            @foreach (var e in estados)
            {
                if (estadoSel == e)
                {
                    <option value="@e" selected>@e</option>
                }
                else
                {
                    <option value="@e">@e</option>
                }
            }
        </select>
    </div>

    <div class="col-md-4">
        <label for="edad" class="form-label">Edad</label>
        <select id="edad" name="edad" class="form-select">
            <option value="">-- Todas --</option>
            @foreach (var e in edades)
            {
                if (edadSel.HasValue && edadSel.Value == e)
                {
                    <option value="@e" selected>@e año(s)</option>
                }
                else
                {
                    <option value="@e">@e año(s)</option>
                }
            }
        </select>
    </div>

    <div class="col-md-4">
        <label for="raza" class="form-label">Raza</label>
        <select id="raza" name="raza" class="form-select">
            <option value="">-- Todas --</option>
            @foreach (var r in razas)
            {
                if (razaSel == r)
                {
                    <option value="@r" selected>@r</option>
                }
                else
                {
                    <option value="@r">@r</option>
                }
            }
        </select>
    </div>

    <div class="col-12 d-flex justify-content-end">
        <button type="submit" class="btn btn-primary">Filtrar</button>
    </div>
</form>


<div class="row row-cols-1 row-cols-md-3 g-4">
    @foreach (var item in Model)
    {
        <div class="col">
            <div class="card card-animal shadow-sm">
                <img src="@Url.Content($"~/imagenes/animal/{(string.IsNullOrEmpty(item.Foto) ? "default-animal.jpg" : item.Foto)}")"
                     class="card-img-top img-animal"
                     alt="Imagen de @item.Nombre" />
                <div class="card-body">
                    <h5 class="card-title">@item.Nombre</h5>
                    <p><strong>Especie:</strong> @item.Especie</p>
                    <p><strong>Raza:</strong> @item.Raza</p>
                    <p><strong>Edad:</strong> @item.Edad año(s)</p>
                    <p><strong>Estado:</strong> @item.Estado</p>
                </div>

                <div class="card-footer text-center">
                    <a asp-controller="Animal" asp-action="Details" asp-route-id="@item.IdAnimal" class="btn btn-outline-primary btn-sm">
                        Ver detalles
                    </a>
                </div>
            </div>
        </div>
    }
</div>
